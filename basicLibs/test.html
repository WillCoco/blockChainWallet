<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="./chain33Wallet.js"></script>
    <script src="./test/bitcoin.js"></script>
    <script src="./bip39.js"></script>
</head>
<body>

</body>
<script>
  const {newWalletFromMnemonic} = window.chain33Wallet.seed;
  /**
   * chain33wallet
   */
  const bip44Constants = {
    "BTY": 0x80003333,
    "TBTC": 0x80000001,
    "BTC": 0x80000000,
    "BCH": 0x80000091,
    "BSV": 0x800000ec,
  };

  const mnemonic = 'enjoy juice vicious join animal joke bean basic tongue child acid learn silly outdoor stereo';

  // UTC
  const btyWalletObj = newWalletFromMnemonic(mnemonic);
  const btyAccount1 = btyWalletObj.newAccount('钱包1');
  console.log(btyWalletObj, 'btyWalletObj');
  console.log(btyAccount1, 'bty');


  const {bip39, bitcoinjs} = window;
  const {bip32} = bitcoinjs;
  const seed = bip39.mnemonicToSeedSync(mnemonic); // btcWalletObj.rootSeed 一致
  const root = bip32.fromSeed(seed); // btcWalletObj.masterKey 一致
  const strng = root.toBase58();

   /**
   * TBTC
   */
  const tbtcWalletObj = newWalletFromMnemonic(mnemonic, bip44Constants.TBTC);
  const tbtcAccount1 = tbtcWalletObj.newAccount('钱包1');

  const tbtcPath = "m/44'/1'/0'/0/0";
  const tbtcChild = root.derivePath(tbtcPath);
  console.log(tbtcAccount1, 'xxxxx');

  console.log(tbtcAccount1.address, 123123);
  console.log(getAddress(tbtcChild, bitcoinjs.networks.testnet), '测试网地址');

  /**
   * BTC
   */
  // chain33wallet
  const btcWalletObj = newWalletFromMnemonic(mnemonic, bip44Constants.BTC);
  const btcAccount1 = btcWalletObj.newAccount('钱包1');
//  console.log(btcWalletObj, 'btcWalletObj');
  console.log(btcAccount1, 'btc');
//  console.log(btcWalletObj.masterKey, 'btcWalletObj.masterKey');

  // bitcoinjs



  console.log('btc总私钥：', btcWalletObj.masterKey.toBase58()); // 总私钥
  console.log('btc总私钥一致：', btcWalletObj.masterKey.toBase58() === strng); // 总私钥一致

//  // 方式1
//  const path = "m/44'/0'/0'/0/0";
//  const child1 = root.derivePath(path);

//  // 方式2 chain33wallet中的
//  var PURPOSE = 0x8000002C;
//  let child1 = root.derive(PURPOSE);
//  child1 = child1.derive(bip44Constants.BTC); // cointype
//  child1 = child1.derive(bip44Constants.BTC); //
//  child1 = child1.derive(0);
//  child1 = child1.derive(0);

  // 方式3
  let btcChild = root
    .deriveHardened(44)
    .deriveHardened(0)
    .deriveHardened(0)
    .derive(0)
    .derive(0);

//  let tbtcChild1 = root
//    .deriveHardened(44)
//    .deriveHardened(1)
//    .deriveHardened(0)
//    .derive(0)
//    .derive(0);

//  const testAddress = getAddress(tbtcChild1, bitcoinjs.networks.testnet); // 测试
  const address = getAddress(btcChild); // 正式
//  console.log(testAddress, 'testAddress');
  console.log('btc地址一致：', address === '1BQB8PgxTvRS7wLkZrqwPrck87Do1d3xbK', ); // 地址一致


  // BCH
  // chain33wallet
  const bchWalletObj = newWalletFromMnemonic(mnemonic, bip44Constants.BCH);
  const bchAccount1 = bchWalletObj.newAccount('钱包1');
  console.log(bchAccount1, 'bch');
  console.log('bch总私钥：', bchWalletObj.masterKey.toBase58()); // 总私钥

  // bitcoinjs
  const bchPath = "m/44'/145'/0'/0/0";
  const bchChild = root.derivePath(bchPath);


  const bchAddress = getAddress(bchChild);

  console.log('bchAddress地址一致：', bchAddress === bchAccount1.address);
  console.log('bchAddress是老格式的：', bchAddress, bchAccount1.address);

  // BSV
  const bsvWalletObj = newWalletFromMnemonic(mnemonic, bip44Constants.BSV);
  const bsvAccount1 = bsvWalletObj.newAccount('钱包1');
  console.log(bsvAccount1, 'bsv');

  const bsvPath = "m/44'/236'/0'/0/0";
  const bsvChild = root.derivePath(bsvPath);
  const bsvAddress = getAddress(bsvChild);

  console.log('bsvAddress地址一致：', bsvAddress === bsvAccount1.address);
  console.log('bsvAddress：', bsvAddress, bsvAccount1.address);

  function getAddress(node, network) {
    return bitcoinjs.payments.p2pkh({ pubkey: node.publicKey, network }).address;
  }

  const p = {
    name: '123123',
    mnemonic: 'enjoy juice vicious join animal joke bean basic tongue child acid learn silly outdoor stereo',
    password: '123123123',
    coins: {
      BTC: {
        symbol: 'BTC',
        name: 'BTC',
        bip44Constant: 0x80000000,
        order: 2,
        satoshiDigit: 8,
        showDigit: 8,
        defaultFee: 400,
        explorerUrl: 'https://www.utcpark.com',
        explorerTestUrl: 'https://www.utcpark.com',
        // 内置节点
        nodes: {
          testnet: [
            'https://testnet.utcpark.com:8801/',
          ],
          mainnet: [
            'https://testnet.utcpark.com:8801/',
          ],
        },
      },
      TBTC: {
        symbol: 'TBTC',
        name: 'TBTC',
        bip44Constant: 0x80000001,
        order: 0,
        satoshiDigit: 8,
        showDigit: 8,
        defaultFee: 400,
        explorerUrl: 'https://www.utcpark.com',
        explorerTestUrl: 'https://www.utcpark.com',
        // 内置节点
        nodes: {
          testnet: [
            'https://testnet.utcpark.com:8801/',
          ],
          mainnet: [
            'https://testnet.utcpark.com:8801/',
          ],
        },
      },
    },
  }

  window.walletBase.recoverWalletFromMnemonic(p)

</script>
</html>