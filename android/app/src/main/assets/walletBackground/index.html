<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="./lib/bitcoin.js"></script>
    <script src="./lib/chain33wallet.js"></script>
    <script src="./lib/chain33Rpc.js"></script>
    <script src="./lib/bip39.js"></script>
    <script src="./lib/crypto.js"></script>
    <script src="./walletBase.js"></script>
</head>
<style>
    body {
        border: 1px solid #3e8eff
    }

    p {
        font-size: 60px
    }
</style>
<script>
  /**
   * 监听RN webview 发送到 html5 的消息
   */
  window.onload = function () {
    document.addEventListener("message", function (msg) {
      var data = safeParse(msg && msg.data) || {};
      var payloadAction = data.action;

      var action = pickerActions(payloadAction);

      var response;
      try {
        response = action(data);
        window.ReactNativeWebView.postMessage(safeStringify(response));
      } catch (error) {
        window.ReactNativeWebView.postMessage(safeStringify({error}));
      }
    });
  };

  function pickerActions(action) {
    switch (action) {
      case 'CREATE_WALLET':
        return window.walletBase.createWallet;
      case 'AES_DECRYPT':
        return window.walletBase.decrypt;
      case 'AES_ENCRYPT':
        return window.walletBase.encrypt;
      case 'RECOVER_WALLET_FROM_MNEMONIC':
        return window.walletBase.recoverWalletFromMnemonic;
      default:
        alert('UNDEFINED ACTION:' + action);
    }
  }

  function safeParse(json) {
    var data;
    try {
      data = JSON.parse(json)
    }
    catch (err) {
      alert('JSON.parse error')
    }
    return data;
  }

  function safeStringify(data) {
    var json;
    try {
      json = JSON.stringify(data)
    }
    catch (err) {
      alert('JSON.stringify error')
    }
    return json;
  }
</script>
<body>
<p>WebView Wallet Helper</p>
</body>
</html>